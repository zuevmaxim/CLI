# CLI

***Перед запуском установите библиотеки:***
```
pip install lark-parser==0.7.8
pip install parameterized
```
 
***Запуск***(из корневой директории): `python main.py`
 
***Запуск тестов***(из корневой директории): `python -m unittest`

***Диаграмму классов*** можно найти по [ссылке](https://drive.google.com/open?id=17upEN-eFoba0HDIWcBM1FjDuDy4LM-l6).

#### Детали реализации:
1. `Shell` инкапсулирует в себе логику всего интерпретатора. Хранит:
    * `Environment` хранит состояние оболочки(переменные окружения и статус). *Замечание*: обращение к ранее неопределенной переменной считается ошибкой и прерывает исполнение текущей команды
    * `HandlersNet` инкапсурирует конвеер из `Handler`-ов, занимающихся всей обработкой
2. `Handler` - абстрактный элемент конвеера, выполняющий обработку в методе `run(request)`, после чего вызывается метод `onFinish(result)`, извещающий остальные звенья конвеера
    * `InputHandler` считывает данные из входного потока
    * `SubstitutionHandler` парсит вход с помощью `SubstitutionParser` с целью выполнить подстановку(отператор `$`) и обрато собирает все в строку
    * `ParserHandler` парсит строку с помощью `ShellParser` и возвращает список команд
    * `RunCommandsHandler` запускает команды последовательно, перенаправляя через PIPE(`|`) потоки ввода и вывода для команд
    * `OutputHandler` печатает результат в выходной поток
3. Парсеры используют библеотеку [lark](https://github.com/lark-parser/lark). Используются трансформеры для преобразования AST в нужные данные:
    * `SubstitutionTransformer` подменяет токен `$name` на значение соответствующей переменной из `Environment`
    * `ShellTransformer` преобразует AST в список команд, получая команды с помощью `CommandFactory`, которая по имени команды генерирует объект типа `Command`
4. `Command` - абстрактный класс команды. При создании указывается список строковых аргументов. Вызов команды происходит методом `execute`, определяющим потоки ввода и вывода для команды. Поддерживаются следующие команды:
    * `CatCommand`: `cat [FILE]` - конкатинирует и выводит файлы, переданные в аргументах, если таких нет, перенаправляет поток входа дальше.
    * `EchoCommand`: `echo [args]` - печатает переданные аргументы, игнорирует входной поток
    * `ExitCommand` : `exit` - завершает shell, игнорирует аргументы и входной поток. Выставляет в `Environment` статус завершения
    * `PwdCommand`: `pwd` - печатает текущую директорию, игнорирует аргументы и входной поток
    * `WcCommand`: `wc [FILE]` или `text | wc` - считает количесво строк, слов и байт в файлах-аргументах(или во входном потоке, если нет аргументов). Выводит результат в формате: `newlines = [N];  words = [N]; bytes = [N] [FILE]`, и если файлов несколько, последней строкой сумиирует результаты с меткой `total`
    * `AssignmentCommand` : `var = string` - присвоение значения в переменную, значением может быть только строка(не вызов команды)
    * `GrepCommand` - поиск шаблона в строке или файле.
    * `CdCommand` - изменяет текущую директорию.
    * `LsCommand` - список файлов в директории.
    * `CustomCommand` - при несовпадении имени команды с одиним из предыдущих вызывается команда, которая ищется в `PATH` или файловой системе
